# Запуск приложения
Для запуска сервиса используется файл docker-compose.yml и, соответственно,   
команда `docker-compose up -d`, выполненняемая из корня.



# Выполнение тестов
Для проведения тестов создан отдельный файл docker-compose-test.yml.  
Команда `docker-compose -f docker-compose-test.yml up -d` поднимает контейнеры, в которых автоматически проводятся тесты и проверка на pep8  
  
Увидеть результаты тестирования можно в логах контейнера DigitalPower_test


# Ответы на некоторые возможные вопросы
1. Помимо кэширование эмотиконов на сервере, использовал expires в nginx, чтобы они кэшировались у пользователей. Для этого был добавлен обязательный параметр `username` в запросе эмотикона, чтобы для браузера запросы были разными и для каждого пользователя они нормально кэшировались.
2. Кэширование эмотиконов выбранно через сохранение байтов в redis, чтобы максимально быстро  
отдавать их из ОЗУ. При малом количестве пользователей работать сервис будет максимально бытсро и занимать мало памяти.  
При необходимости можно легко переписать на хранение в ПЗУ. 
3. Подключение к базе данных в тестах осуществляется в самой реализации теста, потому что `fastapi.testclient.TestClient` занимает базу и через фикстуру выдать подключение к базе в тесте невозможно, так как выпадает ошибка.
4. В тестах был замокан "внешний" сервис по генерации эмотиконов
5. В `app.py.startup` навел немного грязи с `while True`, чтобы избежать краша при попытке подключиться к базе.


#### Естественно есть куда расти:
1. Сделать комбинированное кэширование (Самые "популярные" эмотиконы в ОЗУ, остальные в ПЗУ, для удешевления содержания микросервиса), если в этом будет необходимость.
2. Добавить реализацию refresh_token
3. Сделать невозможным существования множество валидных токенов авторизации, добавив "протухание" старых токенов, при выпуске новых.
4. Провести нагрузочное тестирование (яндекс танк, например)



### Настройка виртуального окружения
- JWT_SECRET - ключ для хэширования паролей пользователей
- REDIS_URL  - url для подключения к базе редиса
- PG_PASS, PG_USER   - пароль и логин в базе postgres
- PG_DB_NAME - название рабочей базы данных
- PG_HOST, PG_PORT - хост и порт для подключения к базе данных


#### Предосторежение
Код точно рабочий, чтобы перезапустить с приложения на тесты, или что-то конкретно поменять в docker-compose файлах, то лучше полностью удалить контейнеры, потому что иногда не схватывает при пересоздании: изменения/настройки другого файла не вступают в силу.
